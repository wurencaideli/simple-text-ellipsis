{
    "version": 3,
    "file": "smart-text-ellipsis.cjs.js",
    "sources": [
        "../src/common.js",
        "../src/index.js"
    ],
    "sourcesContent": [
        "export function removeElement(element) {\n    if (element && element.parentNode) {\n        element.parentNode.removeChild(element);\n    }\n}\nexport function addElementClass(el, className) {\n    el.classList.add(className);\n}\nexport function removeElementClass(el, className) {\n    el.classList.remove(className);\n}\n",
        "import { addElementClass, removeElement, removeElementClass } from './common';\nexport class SmartTextEllipsis {\n    isDestroyed = false;\n    maxLines = 0;\n    targetEl = undefined;\n    expandEl = undefined;\n    collapseEl = undefined;\n    placeholderEl = undefined;\n    isOpen = false;\n    #lineHeight = 0;\n    constructor(options = {}) {\n        const targetEl = options.targetEl;\n        const isOpen = options.isOpen;\n        const maxLines = options.maxLines;\n        const expandEl = document.createElement('span');\n        const collapseEl = document.createElement('div');\n        const placeholderEl = document.createElement('div');\n        expandEl.innerText = options.expandElText || 'Expand';\n        collapseEl.innerText = options.collapseElText || 'Collapse';\n        expandEl.onclick = () => {\n            this.#handleExpand();\n        };\n        collapseEl.onclick = () => {\n            this.#handleCollapse();\n        };\n        addElementClass(collapseEl, 'smart-text-ellipsis-collapse');\n        addElementClass(expandEl, 'smart-text-ellipsis-expand');\n        addElementClass(placeholderEl, 'smart-text-ellipsis-placeholder');\n        targetEl.prepend(expandEl);\n        targetEl.prepend(placeholderEl);\n        targetEl.appendChild(collapseEl);\n        this.targetEl = targetEl;\n        this.isOpen = isOpen;\n        this.maxLines = maxLines;\n        this.expandEl = expandEl;\n        this.collapseEl = collapseEl;\n        this.placeholderEl = placeholderEl;\n        this.update();\n    }\n    /** 销毁实例 */\n    destroy() {\n        this.isOpen = true;\n        removeElement(this.expandEl);\n        removeElement(this.collapseEl);\n        this.#setupClass();\n        this.targetEl = undefined;\n        this.expandEl = undefined;\n        this.collapseEl = undefined;\n        this.isDestroyed = true;\n    }\n    /** 更新样式 */\n    update() {\n        if (this.isDestroyed) return;\n        this.#lineHeight = this.#getLineHeight();\n        this.#setupClass();\n        this.#setupPlaceholderStyle();\n        this.#setupBtClass();\n    }\n    #handleExpand() {\n        if (this.isDestroyed) return;\n        this.isOpen = true;\n        this.update();\n    }\n    #handleCollapse() {\n        if (this.isDestroyed) return;\n        this.isOpen = false;\n        this.update();\n    }\n    /** 设置容器的类名 */\n    #setupClass() {\n        const targetEl = this.targetEl;\n        if (!targetEl) return;\n        if (!this.isDestroyed) {\n            targetEl.style.setProperty('--max-lines', `${this.maxLines}`);\n        } else {\n            targetEl.style.setProperty('--max-lines', undefined);\n        }\n        if (this.maxLines == 1) {\n            addElementClass(targetEl, 'smart-text-ellipsis-one');\n            removeElementClass(targetEl, 'smart-text-ellipsis-more');\n        } else {\n            addElementClass(targetEl, 'smart-text-ellipsis-more');\n            removeElementClass(targetEl, 'smart-text-ellipsis-one');\n        }\n        if (this.isOpen) {\n            removeElementClass(targetEl, 'smart-text-ellipsis-more');\n            removeElementClass(targetEl, 'smart-text-ellipsis-one');\n        }\n        removeElementClass(targetEl, 'is-ellipsis');\n        removeElementClass(targetEl, 'is-exceeded-max-line');\n    }\n    /** 设置按钮的类名 */\n    #setupBtClass() {\n        if (this.isDestroyed) return;\n        const targetEl = this.targetEl;\n        if (!targetEl) return;\n        if (this.isOpen) {\n            // 如果行数超过了，显示收缩按钮\n            if (this.#getActualLines() > this.maxLines) {\n                addElementClass(targetEl, 'is-exceeded-max-line');\n            }\n        } else {\n            // 如果字体省略了，显示展开按钮\n            if (this.#isEllipsisActive()) {\n                addElementClass(targetEl, 'is-ellipsis');\n            }\n        }\n    }\n    /** 设置占位元素的样式 */\n    #setupPlaceholderStyle() {\n        const lineHeight = this.#lineHeight;\n        const placeholderEl = this.placeholderEl;\n        const targetEl = this.targetEl;\n        placeholderEl.style.height = `${targetEl.clientHeight - lineHeight}px`;\n    }\n    /** 获取一行文本的高度 */\n    #getLineHeight() {\n        const targetEl = this.targetEl;\n        if (!targetEl) return;\n        return parseFloat(getComputedStyle(targetEl).lineHeight) || 24;\n    }\n    /** 判断是否省略了 */\n    #isEllipsisActive() {\n        const maxLines = this.maxLines;\n        const el = this.targetEl;\n        if (maxLines === 1) {\n            return el.scrollWidth > el.clientWidth;\n        }\n        return el.scrollHeight > el.clientHeight;\n    }\n    /** 获取文本视觉上的行数 */\n    #getActualLines() {\n        const targetEl = this.targetEl;\n        const collapseEl = this.collapseEl;\n        const lh = this.#lineHeight;\n        return Math.floor((targetEl.clientHeight - collapseEl.clientHeight) / lh);\n    }\n}\n"
    ],
    "names": [
        "removeElement",
        "element",
        "parentNode",
        "removeChild",
        "addElementClass",
        "el",
        "className",
        "classList",
        "add",
        "removeElementClass",
        "remove",
        "isDestroyed",
        "maxLines",
        "targetEl",
        "undefined",
        "expandEl",
        "collapseEl",
        "placeholderEl",
        "isOpen",
        "lineHeight",
        "constructor",
        "options",
        "document",
        "createElement",
        "innerText",
        "expandElText",
        "collapseElText",
        "onclick",
        "this",
        "handleExpand",
        "handleCollapse",
        "prepend",
        "appendChild",
        "update",
        "destroy",
        "setupClass",
        "getLineHeight",
        "setupPlaceholderStyle",
        "setupBtClass",
        "style",
        "setProperty",
        "getActualLines",
        "isEllipsisActive",
        "height",
        "clientHeight",
        "parseFloat",
        "getComputedStyle",
        "scrollWidth",
        "clientWidth",
        "scrollHeight",
        "lh",
        "Math",
        "floor"
    ],
    "mappings": "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"
}
